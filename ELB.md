## Amazon Elastic Load Balancing (ELB)

Elastic Load Balancing (ELB) automatically distributes incoming application traffic across multiple targets including:

*   Amazon ([[EC2]]) Instances
*   Containers ([[ECS]])
*   IP addresses  
*   [[Lambda]] functions

### There are four types of Elastic Load Balancer (ELB) on AWS:

##### - Application Load Balancer ([[ALB]])
Layer 7 load balancer that routes connections based on the content of the request ([[HTTP]]/[[HTTPS]]).

##### - Network Load Balancer ([[NLB]])
Layer 4 load balancer that routes connections based on IP protocol data ([[TLS]]/[[TCP]]/[[UDP]]).

##### - (OLD) Classic Load Balancer ([[CLB]])
This is the oldest of the three and provides basic load balancing at both layer 4 and layer 7 (not on the exam anymore).

##### - Gateway Load Balancer ([[GLB]])
Layer 3 load balancer that routes connections by deciding the physical path on the network level of the  ([[OSI]]) model.
Used in front of virtual appliances such as [[firewall]]s, [[IDS]]/[[IPS]], and [[DPI]] and scales them up or down.

![[Pasted image 20221116171632.png]]

There is a key difference in how the load balancer types are configured. With Application Load Balancers ([[ALB]]), Network Load Balancers ([[NLB]]), and Gateway Load Balancers ([[GLB]]), you register targets in [[target group]]s, and route traffic to the target groups. With Classic Load Balancers ([[CLB]]), you register instances with the load balancer.

![[Pasted image 20221116171413.png]]

### Provides fault tolerance for applications:

-   Distributes incoming traffic in a single [[AZ]] or multiple [[AZ]]s
-   Only 1 [[subnet]] per [[AZ]] can be enabled for each ELB
==-   Ensure at least a /27 subnet and make sure there are at least 8 IP addresses available for the ELB to scale==
*   ELB features **high availability**, **[[auto scaling]]**, and **robust security** necessary to make your applications fault tolerant.

![[Pasted image 20230204112705.png]]

### ELBs can be Internet facing or internal-only

##### - Internet facing ELB:  
*   ELB nodes have **public IPs**
*   Routes traffic to the **private IP** addresses of the [[EC2]] instances
*   Need one **public [[subnet]]** in each [[AZ]] where the ELB is defined

##### - Internal only ELB:  
*   ELB nodes have **private IPs**  
*   Routes traffic to the **private IP** addresses of the [[EC2]] instances

### [[Cross-Zone]] Load Balancing

##### - When cross-zone load balancing is enabled:
*   Each load balancer node distributes traffic across the registered targets in all enabled [[AZ]]s
*   With Application Load Balancers ([[ALB]]), cross-zone load balancing is **always enabled**
* 
##### - When cross-zone load balancing is disabled:
-   Each load balancer node distributes traffic only across the registered targets in its AZ
-   With Network Load Balancers ([[NLB]]) and Gateway Load Balancers ([[GLB]]), cross- zone load balancing is **disabled by default**

## [[Stickiness]] type: 

##### Cookies:
*   Load Balancer generated [[cookie]]
*   Application-based [[cookie]].

Both of them are generated by the ELB. They are not generated by the application.
The key difference is, with a load balancer generated cookie, the cookie Name is always **AWS ALB**. So if you have multiple layers of load balancer in your architecture, then the cookie name is going to be the same and that could be a problem.
You can then use an application-based cookie and then for each [[target group]] you can specify a different cookie name.

##### Storing session state data
*  Session data such as authentication details stored in [[DynamoDB]] Table
*   [[ElastiCache]] is also a popular solution for storing session-state data
*   User does not need to re-authenticate

##### Sticky session
*   Session data such as authentication details stored **locally**
*   If an instance fails, session state is lost – use with **session state store** for more resiliency
*   Cookie is generated and client bound to instance for **cookie lifetime**

![[Pasted image 20230204133832.png]]

*   **Group-level stickiness**: If a target group is sticky, requests routed to it remain in that [[target group]] for the duration of the session. 
*   **Individual target stickiness** is a configuration of the [[target group]].

### Target Group [[Health check]] with [[NLB]]: 

*   NLB can't route based on [[HTTP]] information, but it can make a connection request to the [[EC2]] instance.

## ELB configuration ([[Listener]])

You configure your load balancer ([[ELB]]) to accept incoming traffic by specifying one or more [[listener]]s. A listener is a process that checks for connection requests. It is configured with a protocol and port number for connections from clients to the load balancer. Likewise, it is configured with a protocol and port number for connections from the load balancer to the targets.
 